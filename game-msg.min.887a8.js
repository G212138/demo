(()=>{var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),("undefined"==typeof window?e.g:window).aliLogMsg={b_init:!1,baseUrl:"",params:{},initBaseUrl(e,t,s){this.baseUrl=`https://${t}.${e}/logstores/${s}/track?APIVersion=0.6.0`},push(e,t){this.params[e]=t},send(){let e=new XMLHttpRequest,t="";for(let e in this.params)t+=`&${e}=${this.params[e]}`;this.params={},t=this.baseUrl+t,console.log(t),e.open("GET",t),e.setRequestHeader("Content-Type","application/json;charset=utf-8"),e.timeout=1e4,e.onerror=function(e){console.error("fail to send log",e)},e.ontimeout=function(e){console.error("fail to send log",e)},e.send()},meta:[],seq:0,queue:[],reporting:!1,uuid:"",generateUUID(){if(""==this.uuid){var e=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(e+=performance.now());var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var s=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?s:3&s|8).toString(16)}));this.uuid=t}},setMeta(e,t){this.meta.push([e,t])},doLog(e,t){this.queueLog(e,t)},async queueLog(e,t){const s=this.getFormatedTimeString();this.queue.push([e,t,s]),this.reportIt()},async reportIt(){if(!this.reporting){for(this.reporting=!0;this.queue.length>0;){const[e,t,s]=this.queue.shift();await this.singleLog(e,t,s)}this.reporting=!1}},singleLog(e,t,s){for(const[e,t]of this.meta)this.push(e,t);return this.push("seq",""+ ++this.seq),this.push("t",s),this.push("level",e),this.push("msg",t.length>3e3?t.slice(0,3e3):t),this.send()},pad:(e,t)=>("0".repeat(t)+e).slice(-t),getFormatedTimeString(){const e=new Date;return e.getFullYear()+"-"+this.pad(e.getMonth()+1,2)+"-"+this.pad(e.getDate(),2)+"T"+this.pad(e.getHours(),2)+":"+this.pad(e.getMinutes(),2)+":"+this.pad(e.getSeconds(),2)+"."+this.pad(e.getMilliseconds(),3)},prefix:"",setRemoteLogInfo(e,t){this.setMeta("src",`${e} - ${t}`)},log(e,...t){this.info(e,...t)},info(e,...t){this.logIt("info",e,...t)},warn(e,...t){this.logIt("warn",e,...t)},error(e,...t){this.logIt("error",e,...t)},log2(e,t,...s){this.logIt(e,t,...s)},logIt(e,t,...s){const a=`${t} ${this.stringifyMsg(...s)}`,n=this.prefix?this.prefix+a:a;this.doLog(e,n)},stringifyMsg:(...e)=>e.map((e=>"string"==typeof e?e:JSON.stringify(e))).join(" "),consoleHandler(e,t,...s){switch(e){case"info":console.info(prefix+t,...s);break;case"warn":console.warn(prefix+t,...s);break;case"error":console.error(prefix+t,...s)}},init(e,t,s,a,n){this.b_init||(this.b_init=!0,this.initBaseUrl("cn-beijing.log.aliyuncs.com", "ledu-saas-jiaohuyouxi", "interaction-game"),this.seq=0,this.generateUUID(),this.setMeta("uuid",`${this.uuid}-${t}`),this.setMeta("coursewareId",s),this.setMeta("gameId",a),this.setMeta("env",n),this.setRemoteLogInfo(e,t))},engineLoadStart(){this.info("engineLoadStart",`url: ${location.href}`)},engineLoadEnd(){this.info("engineLoadEnd")},resLoadStart(){this.info("resLoadStart")},resLoadEnd(){this.info("resLoadEnd")},gameMsg_gameStart(){this.info("gameMsg_gameStart")},iframeMsg_gameStart(){this.info("iframeMsg_gameStart")},gameLevelReport(e){this.info("gameLevelReport",e)},gameOverReport(e){this.info("gameOverReport",e)},gameStop(){this.info("gameStop")},gameFinish(){this.info("gameFinish")},URLError(e){this.error("URLError",e)},httpTimeOut(e){this.error("httpTimeOut",e)},httpError(e){this.error("httpError",e)},differntKey(e){this.error("differntKey",e)}},("undefined"==typeof window?e.g:window).iframeMsg={send_as_message(e){var t=this.getURLparam("groupId")||123;t&&window.parent!==window&&(e.groupId=t,window.parent.postMessage(e,"*"))},on_as_message(e,t){window.addEventListener("message",(s=>{const a=s.data;if(a){"getTransferReport"==a.type&&(a.type="recv_sync_data");const{type:s}=a;s===t&&e(a)}}))},getURLparam(e){var t=location.href.split("?");if(t.length<2)return null;for(var s=t[1].split("&"),a=0;a<s.length;a++)if(0===s[a].indexOf(e+"="))return s[a].substring(e.length+1);return null},recv_sync_data(e){this.on_as_message(e,"recv_sync_data")},recv_store_data(e){this.on_as_message(e,"recv_store_data")},recv_msg_frequency(e){this.on_as_message(e,"recv_msg_frequency")},send_sync_data(e){var t={type:"send_sync_data",data:e};this.send_as_message(t)},game_start(e){var t={type:"game_start",data:e};this.send_as_message(t)},get_store_data(e){var t={type:"get_store_data",data:e};this.send_as_message(t)},get_role(e){var t=this.getURLparam("role");console.log("role ",t),e(t)},get_is_sync(e){let t=this.getURLparam("isSync");e("1"==t||"true"==t)},store_data(e){var t={type:"store_data",data:e};this.send_as_message(t)},recv_json_data(e){this.on_as_message(e,"recv_json_data")},request_json_data(e){var t={type:"request_json_data",data:e};this.send_as_message(t)},request_fps(e){var t={type:"request_fps",data:e};this.send_as_message(t)},recv_sync_3s_data(e){this.on_as_message(e,"recv_sync_3s_data")},send_sync_3s_data(e){this.send_as_message({type:"send_sync_3s_data",data:e})},recv_show_gamePanel(e){this.on_as_message(e,"recv_show_gamePanel")},recv_hide_gamePanel(e){this.on_as_message(e,"recv_hide_gamePanel")},request_res_load_start(e){this.send_as_message({type:"request_res_load_start",data:e})},res_load_process(e){this.send_as_message({type:"res_load_process",data:e})},request_res_load_end(e){this.send_as_message({type:"request_res_load_end",data:e})},request_engine_load_start(e){this.send_as_message({type:"request_engine_load_start",data:e})},request_engine_load_end(e){this.send_as_message({type:"request_engine_load_end",data:e})},recv_keep_playing(e){this.on_as_message(e,"recv_keep_playing")},request_keep_playing(e){this.send_as_message({type:"request_keep_playing",data:e})},recv_cancel_keep_playing(e){this.on_as_message(e,"recv_cancel_keep_playing")},recv_restart(e){this.on_as_message(e,"recv_restart")},request_restart_over(e){this.send_as_message({type:"request_restart_over",data:e})},request_event_ready(e){this.send_as_message({type:"request_event_ready",data:e})},recv_is_master(e){this.on_as_message(e,"recv_is_master")},request_sync_init(e){this.send_as_message({type:"request_sync_init",data:e})},answer_sync_send(e){this.send_as_message({type:"answer_sync_send",data:{answer_data:e}})},game_over(e){this.send_as_message({type:"game_over",data:e})},request_level_info(e){this.send_as_message({type:"request_level_info",data:e})},game_statistic_data(e){this.send_as_message({type:"game_statistic_data",data:e})},get_is_preload(e){var t=this.getURLparam("isPreload");e("1"==t||"true"==t)},get_is_supportKeepAndRestart(e){var t=this.getURLparam("supportKeepAndRestart");e("1"==t||"true"==t)},request_webglcontextlost(){this.send_as_message({type:"request_webglcontextlost",data:null})}},(()=>{const t=navigator.userAgent,s=t.indexOf("Android")>-1||t.indexOf("Adr")>-1,a=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);window.setupWebViewJavascriptBridge=s?e=>{window.WebViewJavascriptBridge?e(window.WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",(function(){e(window.WebViewJavascriptBridge)}),!1)}:e=>{if(window.WebViewJavascriptBridge)return e(window.WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var t=document.createElement("iframe");t.style.display="none",t.src="wvjbscheme://__BRIDGE_LOADED__",document.documentElement.appendChild(t),setTimeout((function(){document.documentElement.removeChild(t)}),0)},console.log("isAndroid ",s),console.log("isIOS ",a),s&&window.setupWebViewJavascriptBridge((function(e){e.init((function(e,t){console.log(e),t("JS 返回给原生的消息内容")})),e.registerHandler("GameMsg2Web",((e,t)=>{console.log("GameMsg2Web app 返回消息 ",e),n(e),t&&t("")}))})),a&&window.setupWebViewJavascriptBridge((e=>{e.registerHandler("GameMsg2Web",((e,t)=>{console.log("GameMsg2Web app 返回消息 ",e),n(e),t&&t("")}))}));const n=e=>{window.postMessage({type:"gameMsg",msg:e},"*")};("undefined"==typeof window?e.g:window).gameMsg={page_events:{},client_events:["disabled","init","stop","data_recovery","action_sync_receive","reload","threshhold","audio_control","speech_recognition_report","return_microphone_rights"],on_client_event(e,t){if(e&&-1!=this.client_events.indexOf(e)){Object.keys(this.page_events).length||window.addEventListener("message",(e=>{if(e&&e.data){if("gameMsg"!=e.data.type)return;this.exec_handlers(this.page_events[e.data.msg.type],e.data.msg)}}),!1);var s=this.page_events;s[e]?s[e].push(t):s[e]=[t]}else console.warn("不存在的消息类型")},exec_handlers(e,t){if(e&&e.length)for(var s=0,a=e.length;s<a;s++)e[s](t.data)},off(){window.removeEventListener("message")},last:null,last_type:null,threshhold:100,send_to_client(e){let t=+new Date;if(this.last_type==e.type&&this.last&&t<this.last+this.threshhold)return;this.last=t,this.last_type=e.type;let n=window.self==window.parent;var i;console.log("noParent ",n),n?(i=e,(s||a)&&window.setupWebViewJavascriptBridge((e=>{e.callHandler("GameMsg2App",i,(e=>{console.log("GameMsg2App web 发送消息 ",e)}))}))):window.parent.postMessage({type:"gameMsg",msg:e},"*")},engine_load_start(e,t){this.send_to_client({type:"engine_load_start",data:{type:e,engine_version:t}})},engine_load_complete(){this.send_to_client({type:"engine_load_complete"})},res_load_start(e,t){this.send_to_client({type:"res_load_start",data:{type:e,protocol_version:t}})},res_load_process(e){this.send_to_client({type:"res_load_process",data:e})},res_load_complete(){this.send_to_client({type:"res_load_complete"})},answer_sync_send(e){this.send_to_client({type:"answer_sync_send",data:{answer_data:e}})},game_start(){this.send_to_client({type:"game_start"})},game_over(e){this.send_to_client({type:"game_over",data:e})},finished(){this.send_to_client({type:"finished"})},speech_recognition_start(e){this.send_to_client({type:"speech_recognition_start",data:e})},speech_recognition_over(e){this.send_to_client({type:"speech_recognition_over",data:e})},get_microphone_rights(){this.send_to_client({type:"get_microphone_rights"})},game_statistic_data(e){this.send_to_client({type:"game_statistic_data",data:e})}}})()})();